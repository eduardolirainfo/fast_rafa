{% extends "base/layout.html" %}
{% block title %}Editar Perfil - {{ current_user.primeiro_nome }} {{ current_user.sobrenome }}{% endblock %}
{% block content %}
   <!-- Profile Header -->
  <div class="bg-blue-600 h-32 relative">
    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2">
    {% if current_user.url_imagem_perfil %}
      <img
        id="profile-image"
        src="{{ url_for('static',  path=current_user.url_imagem_perfil) }}"
        alt="Foto de Perfil"
        class="profile-image w-32 h-32 rounded-full border-4 border-white object-cover"
      />
      {% else %} {% if current_user.primeiro_nome %}
      <span class="text-md" title="{{current_user.primeiro_nome}}"
                >{{current_user.iniciais}}</span
              >
              {% endif %} {% endif %}
      <label
        for="url_imagem_perfil"
        class="absolute bottom-0 left-1/2 transform -translate-x-1/2 mb-2 cursor-pointer bg-blue-500 text-white p-2 rounded-full"
      >
        <i class="fas fa-camera"></i>
      </label>
    </div>
  </div>

  <!-- Edit Form -->
  <div class="pt-20 text-center">
    <h1 class="text-2xl font-bold text-base-800">
      <i class="fas fa-user-edit mr-2"></i>Editar Perfil
    </h1>

    <form
      action="/auth/update-profile"
      method="post"
      enctype="multipart/form-data"
      class="mt-6 space-y-4 px-6"
    >
      <!-- Primeiro Nome e Sobrenome -->
      <div class="flex flex-col md:flex-row md:space-x-4">
        <div class="flex-1">
          <label for="primeiro_nome" class="block text-sm font-medium text-base-700">
            <i class="fas fa-user mr-2"></i>Primeiro Nome
          </label>
          <input
            type="text"
            id="primeiro_nome"
            name="primeiro_nome"
            value="{{ current_user.primeiro_nome }}"
            class="mt-1 p-2 w-full border border-base-300 rounded-md"
            required
          />
        </div>
        <div class="flex-1">
          <label for="sobrenome" class="block text-sm font-medium text-base-700">
            <i class="fas fa-user mr-2"></i>Sobrenome
          </label>
          <input
            type="text"
            id="sobrenome"
            name="sobrenome"
            value="{{ current_user.sobrenome }}"
            class="mt-1 p-2 w-full border border-base-300 rounded-md"
            required
          />
        </div>
      </div>

      <!-- Email e Telefone -->
      <div class="flex flex-col md:flex-row md:space-x-4">
        <div class="flex-1">
          <label for="email" class="block text-sm font-medium text-base-700">
            <i class="fas fa-envelope mr-2"></i>Email
          </label>
          <input
            type="email"
            id="email"
            name="email"
            value="{{ current_user.email }}"
            class="mt-1 p-2 w-full border border-base-300 rounded-md"
            required
          />
        </div>
        <div class="flex-1">
          <label for="telefone" class="block text-sm font-medium text-base-700">
            <i class="fas fa-phone mr-2"></i>Telefone
          </label>
          <input
            type="tel"
            id="telefone"
            name="telefone"
            value="{{ current_user.telefone }}"
            class="mt-1 p-2 w-full border border-base-300 rounded-md"
          />
        </div>
      </div>

      <!-- Username e Senha na mesma linha -->
      <div class="flex flex-col md:flex-row md:space-x-4">
        <div class="flex-1">
          <label for="username" class="block text-sm font-medium text-base-700">
            <i class="fas fa-at mr-2"></i>Username
          </label>
          <input
            type="text"
            id="username"
            name="username"
            value="{{ current_user.username }}"
            class="mt-1 p-2 w-full border border-base-300 rounded-md"
            required
          />
        </div>
        <div class="flex-1">
          <label for="senha_hash" class="block text-sm font-medium text-base-700">
            <i class="fas fa-lock mr-2"></i>Nova Senha
          </label>
          <input
            type="password"
            id="senha_hash"
            name="senha_hash"
            class="mt-1 p-2 w-full border border-base-300 rounded-md"
            placeholder="Deixe em branco se não quiser alterar"
          />
        </div>
      </div>

      <!-- Organização como Combobox -->
      <div class="flex flex-col md:flex-row md:space-x-4">
        <div class="flex-1">
          <label for="id_organizacao" class="block text-sm font-medium text-base-700">
            <i class="fas fa-building mr-2"></i>Organização
          </label>
          <div class="relative">
                <select
                  name="id_organizacao"
                  required
                  class="mt-1 block w-full max-w-xl rounded-lg border border-base-300 px-3 py-2 pl-10 text-left text-sm text-base-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"
                >
                  {% for org in organizations %}
                  <option value="{{ org.id }}" class="text-base-900">
                    {{ org.display_name }}
                  </option>
                  {% endfor %}
                </select>
                <i
                  class="fas fa-building absolute left-3 top-1/2 transform -translate-y-1/2 text-base-500"
                  style="
                    position: absolute;
                    top: 50%;
                    left: 10px;
                    transform: translateY(-50%);
                  "
                ></i>
              </div>
        </div>
      </div>

      <!-- Foto de Perfil -->
      <div>
        <input
          type="file"
          id="url_imagem_perfil"
          name="url_imagem_perfil"
          class="mt-1 p-2 w-full border border-base-300 rounded-md hidden"
          accept="image/*"
        />
      </div>

      <!-- Diversidade e Acessibilidade -->
      <div class="mt-4 grid grid-cols-2 gap-4">
        <div>
          <label class="flex items-center space-x-2" for "eh_voluntario">
            <input
              type="checkbox"
              name="eh_voluntario"
              {%if current_user.eh_voluntario %}checked{%endif%}
              class="form-checkbox"
            />
            <span class="ml-2"><i class="fas fa-hands-helping mr-1"></i>Voluntário</span>
          </label>
        </div>
        <div>
          <label class="flex items-center space-x-2" for "eh_gerente">
            <input
              type="checkbox"
              name="eh_gerente"
              {%if current_user.eh_gerente %}checked{%endif%}
              class="form-checkbox"
            />
            <span class="ml-2"><i class="fas fa-user-tie mr-1"></i>Gerente</span>
          </label>
        </div>
        <div>
          <label for="deficiencia_auditiva" class="flex items-center space-x-2">
            <input
              type="checkbox"
              id="deficiencia_auditiva"
              name="deficiencia_auditiva"
              {%
              if
              current_user.deficiencia_auditiva
              %}checked{%
              endif
              %}
              class="rounded"
            />
            <span><i class="fas fa-deaf mr-1"></i>Deficiência Auditiva</span>
          </label>
        </div>
        <div>
          <label for="usa_cadeira_rodas" class="flex items-center space-x-2">
            <input
              type="checkbox"
              id="usa_cadeira_rodas"
              name="usa_cadeira_rodas"
              {%
              if
              current_user.usa_cadeira_rodas
              %}checked{%
              endif
              %}
              class="rounded"
            />
            <span
              ><i class="fas fa-wheelchair mr-1"></i>Usa Cadeira de Rodas</span
            >
          </label>
        </div>
        <div>
          <label
            for="deficiencia_cognitiva"
            class="flex items-center space-x-2"
          >
            <input
              type="checkbox"
              id="deficiencia_cognitiva"
              name="deficiencia_cognitiva"
              {%
              if
              current_user.deficiencia_cognitiva
              %}checked{%
              endif
              %}
              class="rounded"
            />
            <span><i class="fas fa-brain mr-1"></i>Deficiência Cognitiva</span>
          </label>
        </div>
        <div>
          <label for="lgbtq" class="flex items-center space-x-2">
            <input
              type="checkbox"
              id="lgbtq"
              name="lgbtq"
              {%
              if
              current_user.lgbtq
              %}checked{%
              endif
              %}
              class="rounded"
            />
            <span><i class="fas fa-rainbow mr-1"></i>LGBTQ+</span>
          </label>
        </div>
      </div>

      <!-- Ações -->
      <div class="mt-6 py-6 flex justify-center">
        <button
          type="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700"
        >
          <i class="fas fa-save mr-2"></i>Salvar Alterações
        </button>
        <a
          href="/profile"
          class="bg-base-600 text-white px-4 py-2 rounded-full hover:bg-base-700"
        >
          <i class="fas fa-times mr-2"></i>Cancelar
        </a>
      </div>
    </form>
  </div>

{% endblock %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const profileImageInput = document.getElementById("url_imagem_perfil");
    const profileImage = document.querySelector(".profile-image");
    const cameraLabel = document.querySelector(
      'label[for="url_imagem_perfil"]'
    );

    profileImageInput.addEventListener("change", function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          profileImage.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Optional: Click on camera icon to trigger file input
    cameraLabel.addEventListener("click", function () {
      profileImageInput.click();
    });
  });
</script>
