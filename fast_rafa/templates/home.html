{% extends "base/layout.html" %} {% block title %}Index{% endblock %} {% block
content %}

<div class="rounded-lg shadow-md overflow-hidden border-2 border-neutral glass">
  <div class="bg-primary text-white py-4 px-6 glass bg-opacity-70">
    <div class="flex items-center">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-1"
        viewBox="0 -960 960 960"
        fill="currentColor"
      >
        <path
          d="M80-160v-160h160v160H80Zm240 0v-160h560v160H320ZM80-400v-160h160v160H80Zm240 0v-160h560v160H320ZM80-640v-160h160v160H80Zm240 0v-160h560v160H320Z"
        />
      </svg>
      <h3 class="text-lg font-semibold">Suas tarefas</h3>
    </div>
  </div>
  <div class="p-6">
    <h5 class="text-xl font-semibold mb-2">Lista de tarefas</h5>
    <div class="overflow-x-auto">
      <table class="table md:table-fixed w-full table-pin-cols">
        <caption class="caption-top">
          Aqui está a lista das suas tarefas. Você pode adicionar novas tarefas,
          marcá-las como concluídas ou excluí-las.
        </caption>
        <thead>
          <tr>
            <th></th>
            <th>Título</th>
            <th>Data/Hora Criação</th>
            <th>Data/Hora Última modificação</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% set contador_de_id = 1 %} {% set completas = [0] %} {% set
          incompletas = [0] %} {% for todo in todos %} {% set contador_de_id =
          contador_de_id + 1 %} {% if todo.priority == 1 and todo.complete ==
          False %}
          <tr
            id="tr-{{  loop.index }}"
            class="bg-green-500 bg-opacity-20 hover:bg-opacity-25"
          >
            {% elif todo.priority == 2 and todo.complete == False %}
          </tr>

          <tr
            id="tr-{{ loop.index }}"
            class="bg-yellow-500 bg-opacity-20 hover:bg-opacity-25"
          >
            {% elif todo.priority == 3 and todo.complete == False %}
          </tr>

          <tr
            id="tr-{{ loop.index }}"
            class="bg-orange-500 bg-opacity-20 hover:bg-opacity-25"
          >
            {% elif todo.priority == 4 and todo.complete == False %}
          </tr>

          <tr
            id="tr-{{ loop.index }}"
            class="bg-red-500 bg-opacity-20 hover:bg-opacity-25"
          >
            {% elif todo.priority == 5 and todo.complete == False %}
          </tr>

          <tr
            id="tr-{{ loop.index }}"
            class="bg-purple-500 bg-opacity-20 hover:bg-opacity-25"
          >
            {% else %} {% if todo.complete == True %}
          </tr>

          <tr
            id="tr-{{ loop.index }}"
            class="hover line-through bg-neutral bg-opacity-20 hover:bg-opacity-25"
          >
            {% else %}
          </tr>

          <tr
            id="tr-{{ loop.index }}"
            class="bg-base-100 bg-opacity-20 hover:bg-opacity-25"
          >
            {% endif %} {% endif %}

            <td>{{ loop.index }}</td>
            <td>
              <h3 class="font-bold">
                {% if todo.complete == True %} {{todo.title| wordwrap(40) }} {%
                else %} {% if todo.created_at and todo.updated_at %} {% set
                difference = todo.updated_at - todo.created_at %} {% set
                total_seconds = difference.total_seconds() %} {% set years =
                (difference.days // 365) %} {% set months = ((difference.days %
                365) // 30) %} {% set days = (difference.days % 365) % 30 %} {%
                set total_minutes = total_seconds // 60 %} {% set hours =
                (total_minutes // 60) % 24 %} {% set minutes = total_minutes %
                60 %} {% set formatted_difference = "" %} {% if years > 0 %} {%
                set formatted_difference = formatted_difference ~ years ~ " anos
                " %} {% endif %} {% if months > 0 %} {% set formatted_difference
                = formatted_difference ~ months ~ " meses " %} {% endif %} {% if
                days > 0 %} {% set formatted_difference = formatted_difference ~
                days ~ " dias " %} {% endif %} {% if hours > 0 %} {% set
                formatted_difference = formatted_difference ~ hours | int ~ "
                horas " %} {% endif %} {% if minutes > 0 %} {% set
                formatted_difference = formatted_difference ~ minutes | int ~ "
                minutos " %} {% endif %} {% set formatted_difference =
                formatted_difference.strip() %} {% endif %}
                <a
                  href="/todos/edit-todo/{{todo.id}}"
                  class="hover:underline"
                  title="Tarefa criada há {{ formatted_difference }}"
                  >{{todo.title| wordwrap(40) }}</a
                >
                {% endif %}
              </h3>
            </td>
            <td>{{ todo.created_at.strftime('%d/%m/%Y %H:%M:%S') }}</td>
            <td>{{ todo.updated_at.strftime('%d/%m/%Y %H:%M:%S') }}</td>
            <td>
              {% if todo.complete == True %} {% set __ =
              completas.append(completas.pop() + 1) %}
              <button
                onclick="window.location.href='/todos/undo-todo/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-primary bg-primary bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Marcar como não concluído"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  viewBox="0 -960 960 960"
                  fill="currentColor"
                >
                  <path
                    d="M280-200v-80h284q63 0 109.5-40T720-420q0-60-46.5-100T564-560H312l104 104-56 56-200-200 200-200 56 56-104 104h252q97 0 166.5 63T800-420q0 94-69.5 157T564-200H280Z"
                  />
                </svg>
              </button>
              <button
                onclick="window.location.href='/todos/delete-todo/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-error bg-error bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Excluir tarefa"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
              {% else %} {% set __ = incompletas.append(incompletas.pop() + 1)
              %} {% set start_at = todo.start_at %} {% set stop_at =
              todo.stop_at %} {% if start_at != none and stop_at is none %} {%
              if current_datetime %} {% if todo.hours_difference is not none and
              todo.start_at is not none %} {% set total_minutes =
              todo.hours_difference | int %} {% set total_minutes_diff =
              current_datetime.replace(tzinfo=None) -
              todo.start_at.replace(tzinfo=None) %} {% set total_minutes_diff =
              total_minutes_diff.total_seconds() // 60 %} {% set total_minutes =
              total_minutes + total_minutes_diff | int %} {% set hours =
              total_minutes // 60 %} {% set minutes = total_minutes % 60 %} {%
              set formatted_time = minutes ~ " minutos" if hours == 0 else hours
              ~ " horas e " ~ minutes ~ " minutos" %} {% endif %} {% endif %}
              <button
                onclick="window.location.href='/todos/stop/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-accent bg-accent bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Parar tarefa com {{ formatted_time }}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 -960 960 960"
                  class="h-6 w-6"
                  fill="currentColor"
                >
                  <path
                    d="M320-320h320v-320H320v320ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"
                  />
                </svg>
              </button>
              <button
                onclick="window.location.href='/todos/complete/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-success bg-success bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Marcar como concluído"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  viewBox="0 -960 960 960"
                  fill="currentColor"
                >
                  <path
                    d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"
                  />
                </svg>
              </button>
              {% else %} {% if stop_at is not none %} {% if
              todo.hours_difference is not none %} {% set total_minutes =
              todo.hours_difference | int %} {% set hours = total_minutes // 60
              %} {% set minutes = total_minutes % 60 %} {% set formatted_time =
              minutes ~ " minutos" if hours == 0 else hours ~ " horas e " ~
              minutes ~ " minutos" %} {% endif %}
              <button
                onclick="window.location.href='/todos/start/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-warning bg-warning bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Reiniciar tarefa que foi interrompida com {{ formatted_time }}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 -960 960 960"
                  class="h-6 w-6"
                  fill="currentcolor"
                >
                  <path
                    d="M440-122q-121-15-200.5-105.5T160-440q0-66 26-126.5T260-672l57 57q-38 34-57.5 79T240-440q0 88 56 155.5T440-202v80Zm80 0v-80q87-16 143.5-83T720-440q0-100-70-170t-170-70h-3l44 44-56 56-140-140 140-140 56 56-44 44h3q134 0 227 93t93 227q0 121-79.5 211.5T520-122Z"
                  />
                </svg>
              </button>
              <button
                onclick="window.location.href='/todos/complete/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-success bg-success bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Marcar como concluído"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  viewBox="0 -960 960 960"
                  fill="currentColor"
                >
                  <path
                    d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"
                  />
                </svg>
              </button>
              {% else %} {% if todo.hours_difference is not none %} {% set
              total_minutes = todo.hours_difference | int %} {% set hours =
              total_minutes // 60 %} {% set minutes = total_minutes % 60 %} {%
              set formatted_time = minutes ~ " minutos" if hours == 0 else hours
              ~ " horas e " ~ minutes ~ " minutos" %} {% endif %}
              <button
                onclick="window.location.href='/todos/start/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-success bg-success bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Iniciar tarefa"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 -960 960 960"
                  class="h-6 w-6"
                  fill="currentColor"
                >
                  <path
                    d="M80-240v-480h80v480H80Zm560 0-57-56 144-144H240v-80h487L584-664l56-56 240 240-240 240Z"
                  />
                </svg>
              </button>
              <button
                onclick="window.location.href='/todos/delete-todo/{{todo.id}}'"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-error bg-error bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Excluir tarefa"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
              {% endif %} {% endif %}
              <a
                href="/todos/edit-todo/{{todo.id}}"
                type="button"
                class="btn btn-circle btn-outline btn-sm btn-info bg-info bg-opacity-20 rounded-xl transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-opacity-50 duration-300"
                title="Visualizar/Editar tarefa"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  viewBox="0 -960 960 960"
                  fill="currentColor"
                >
                  <path
                    d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"
                  />
                </svg>
              </a>

              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="mt-4">
        <a
          href="/todos/add-todo"
          class="btn btn-outline mt-4 btn-success text-white px-4 py-2 mr-2 rounded-md transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-secondary duration-300"
          >Adicionar nova tarefa</a
        >

        <a
          href="/todos/old-tasks"
          class="btn btn-outline mt-4 btn-secondary text-white px-4 py-2 ml-2 rounded-md transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:bg-secondary duration-300"
          >Ver tarefas antigas</a
        >
        <div class="flex justify-end">
          <span
            class="text-sm text-neutral badge badge-success mr-2 badge-outline"
            >Completas: {{ completas[0] }}</span
          >
          <span class="text-sm text-neutral badge badge-error badge-outline"
            >Incompletas: {{ incompletas[0] }}</span
          >
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
